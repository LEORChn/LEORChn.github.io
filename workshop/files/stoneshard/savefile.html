<body>
	<input type="file">
	<textarea></textarea>
	<input type="button" value="Gen" onclick="gen()">
	<div>
		<input id="_salt0" size="32" value="stOne!characters_v1!">
	</div>
	<div>
		<input id="_salt1" size="32" placeholder="salt">
	</div>
	<div>
		<input id="_salt2" size="32" value="!">
	</div>
	<div>
		<input id="_salt3" size="32" placeholder="salt">
	</div>
	<div>
		<input id="_salt4" size="32" value="!shArd">
		<span id="_md5result"></span>
	</div>
</body>
<script src="pako.es5.min.js"></script>
<script src="/js/3/md5.2.18.0.min.js"></script>
<script src="/js/base.js"></script>
<script>
var ff;
var savedata;
$('input').onchange = function(){
	ff = this.files[0];
	this.value = '';
	start();
};
$$('textarea, textarea ~ div > input').foreach(function(e){
	e.oninput = md5update;
});
function md5update(){
	var ta = $('textarea').value,
		res = ta.left(ta.lastIndexOf('}') + 1),
		salt = new Array(5).fill(0).map(function(e, i){
			return window['_salt' + i].value;
		}).join('');
	_md5result.innerText = `${md5(res + salt)}\n${res.length}/${ta.length}\n${salt}`;
}
function start(){
	var fr = new FileReader();
	fr.onload = function(){
		if(type(fr.result) == 'String'){
			var s = fr.result;
			$('textarea').innerText = s;
			savedata = JSON.parse(s);
			return;
		}
		var u8 = new Uint8Array(fr.result);
		try{
			var decoded_bin = pako.inflate(u8);
			pl(decoded_bin);
			var json_bin = new TextDecoder().decode(decoded_bin);//.slice(0, decoded_bin.length - 33);
			$('textarea').value = json_bin;
			//fr.readAsText(new Blob([json_bin]));
		}catch(e){
			pl(e);
		}
	};
	fr.readAsArrayBuffer(ff);
}
function gen(){
	var s = $('textarea').value;
	var uint = pako.deflate(new TextEncoder().encode(s));
	//pl(s, uint);
	hbody.appendChild(new Blob([uint]).toDownload('data.sav'));
}
</script>
