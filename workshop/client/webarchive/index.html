<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<title>web auto save</title>
</head>
<body>
	<a href="https://leorchn.github.io/workshop/">&lt; &#36820;&#22238;&#29790;&#20861;&#35895;</a>
	<form method="post" action="https://web.archive.org/save/https://leorchn.com/archive/www.bilibili.com/read/readlist/u4776884/" target="anotherwindow">
		<label>
			<input type="radio" name="url" value="https://leorchn.com/archive/www.bilibili.com/read/readlist/u4776884/">
			furdex
		</label>
		<label>
			<input type="radio" id="ui_curl_alt" onchange="syntaxCheck()" name="url" checked>
			<input type="text" id="ui_constom_url" oninput="syntaxCheck()" size="48" placeholder="Costom URL">
		</label>
		<input type="hidden" value="on" name="capture_outlinks">
		<input type="hidden" value="on" name="capture_all">
		<input type="hidden" value="on" name="capture_screenshot">
		<input type="hidden" value="on" name="wm-save-mywebarchive">
		<br>
		<input type="button" value="开始" onclick="openwindow()">
	</form>
	<div id="ui_syntax_hint">你输入的网址不符合 /^https?:\/\//i，你确定这样没问题吧？只是随口一说。</div>
<h2>Web-Archive 自动备份</h2>
<h3>注意事项</h3>
<ol>
	<li>
		如果要运行，点一下开始就行。
		<br>
		一般来说只能电脑端运行，因为电脑支持多窗口前台运行。
	</li>
	<li>请留意浏览器的标签页休眠功能，注意将瑞兽谷加入白名单。</li>
	<li>
		窗口最小化可能会导致休眠，所以尽量不要最小化。
		<br>
		如果觉得窗口看着不舒服，可以丢到屏幕外面去，这不算最小化。
	</li>
	<li>
		请注意检查自己的网络。
		<br>
		虽然长时间断网不会导致本程序异常至无法恢复，但确实没法在这期间正常使用功能。
	</li>
	<li>如果要修改列表网址，请编辑源码。</li>
	<li>
		Web Archive 的 Save Page Now 机器人只能同时备份随机 100 个外链，
		<br>
		这也是我做出这个工具的原因，我想要备份的外链太多了。
	</li>
</ol>
<style>
a:not(:hover){
	text-decoration: none;
}
li{
	font-size: 16px;
	line-height: 1.5;
}
#ui_syntax_hint{
	display: none;
	color: red;
}
</style>
</body>
<script src="/js/base.js"></script>
<script src="/js/stats.js" async></script>
<script src="/js/date.js"></script>
<script>
var win, theinterval;
function openwindow(){
	if(isSubWindowAlive()) return;
	win = open('', 'anotherwindow', 'location=no,width=300,height=400');
	theinterval = setInterval(start, 3600 * 1000);
	setTimeout(start, 3000);
	win.document.write('<h2>正在启动，请稍等</h2>');
}
function start(){
	if(!isSubWindowAlive()) return clearTimeout(theinterval);
	document.title = new Date().format('@M-d H:mm');
	ui_curl_alt.value = ui_constom_url.value;
	var fm = $('form');
	fm.action = 'https://web.archive.org/save/' + fm.elements.url.value;
	fm.submit();
}
function syntaxCheck(){
	var usethis = ui_curl_alt.checked,
		text = ui_constom_url.value,
		syntax_illegal = !/^https?:\/\//i.test(text);
	ui_syntax_hint.style.display = usethis && syntax_illegal? 'block': '';
}
window.onbeforeunload = function(){
	if(isSubWindowAlive()) win.close();
};
function isSubWindowAlive(){
	return win && !win.closed;
}
</script>
<details>
	<summary>一份写给某橘猫的笔记</summary>
	<pre>
1.设置一个接口作为【网址列表】用于被 web archive 请求。比如：https://leorchn.com/savetheurls/
2.在你的服务器上存储一个数值，用于记录请求次数。初始化 = 0
3.这个接口每被请求一次，应该执行:
<code class="language-javascript">
var urls = DB.urls, // 取出所有需要备份的网址
	countURLs = urls.length, // 获得网址的总数量
	requestedTimes = DB.requestedTimes, // 取出本接口的已调用次数
	startIndex = (requestedTimes % Math.ceil(countURLs / 100)) * 100; // 根据本接口的已调用次数计算所需要取出的100个网址，实际上这里存储的是第一个网址的下标

DB.requestedTimes = requestedTimes + 1; // 回写已调用次数

var indexRange = [startIndex, startIndex + 99]; // 没有实际作用，只是告诉你此时可能是 [0,99] 或 [100,199] 以此类推

return urls.filter(function(e, i){ // 过滤出应该取出的网址
	return i >= startIndex && i <= startIndex + 99; // 取出这些范围的网址。范围参考 indexRange
}).map(function(e, i){
	return `&lt;a href="${e}">${i}</a>`; // 格式化网址后返回作为body，这里的数据是会返回给 web archive
	// 备注：上一行这个 i 属于个人喜好，对功能影响不大
});
</code>

4.打开浏览器的不同实例。比如 Chrome + Firefox + Edge 的普通和隐身模式都分别算一个实例。

5.确保每个实例都已经登录了【不同的】web archive 帐号。
否则无法备份【网址列表】中的链接，或者被提示【同时会话达到上限】错误

5.每个实例都来到本工具页面，分别填写不一样的列表网址，比如

https://leorchn.com/savetheurls/?thread=1
https://leorchn.com/savetheurls/?thread=2
https://leorchn.com/savetheurls/?thread=3
https://leorchn.com/savetheurls/?thread=4

7.好，可以按【开始】了。
不要最小化窗口，否则可能受到浏览器节能策略影响。
	</pre>
</details>
<style>
	@import "/css/prism-ultraedit.css";
</style>
<script src="/js/3/prism.1.27.0.js"></script>
</html>
